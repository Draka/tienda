var System={functions:{},register:function(e,t,a){System.functions[e]={requires:t,cb:a}},active:function(){$.each(System.functions,function(e,a){e=a.cb(function(e,t){a[e]=t},{id:e});$.each(e.setters,function(e,t){t(System.functions[a.requires[e]])}),e.execute()})}};System.register("libs/edit",[],function(t,e){"use strict";e&&e.id;return{setters:[],execute:function(){function e(){this.itemsAdmin=["heading","|","bold","italic","underline","strikethrough","link","bulletedList","numberedList","|","indent","outdent","|","imageInsert","insertTable","mediaEmbed","blockQuote","|","alignment","fontBackgroundColor","fontColor","fontSize","fontFamily","horizontalLine","|","htmlEmbed","removeFormat","|","code","codeBlock","|","subscript","superscript","|","undo","redo"],this.itemsUser=["heading","|","bold","italic","underline","strikethrough","link","bulletedList","numberedList","|","indent","outdent","|","imageInsert","insertTable","mediaEmbed","blockQuote","|","alignment","fontBackgroundColor","fontColor","horizontalLine","|","removeFormat","|","undo","redo"],this.heading={options:[{model:"paragraph",title:"Parrafo",class:"ck-heading_paragraph"},{model:"heading2",view:"h2",title:"Encabezado 2",class:"ck-heading_heading2"},{model:"heading3",view:"h3",title:"Encabezado 3",class:"ck-heading_heading3"},{model:"heading4",view:"h4",title:"Encabezado 4",class:"ck-heading_heading4"},{model:"title",view:{name:"div",classes:"title"},title:"Título"},{model:"subtitle",view:{name:"div",classes:"subtitle"},title:"Subtítulo"},{model:"big",view:{name:"div",classes:"big"},title:"Grande"},{model:"bigx2",view:{name:"div",classes:"bigx2"},title:"Muy Grande"},{model:"small",view:{name:"div",classes:"small"},title:"Pequeño"},{model:"social",view:{name:"div",classes:"social"},title:"Social"},{model:"remark-error",view:{name:"div",classes:"remark error"},title:"Remark - error"},{model:"remark-info",view:{name:"div",classes:"remark info"},title:"Remark - info"},{model:"remark-action",view:{name:"div",classes:"remark action"},title:"Remark - action"},{model:"remark-primary",view:{name:"div",classes:"remark primary"},title:"Remark - primary"},{model:"remark-secondary",view:{name:"div",classes:"remark secondary"},title:"Remark - secondary"},{model:"msg-error",view:{name:"div",classes:"msg error"},title:"Mensaje - error"},{model:"msg-info",view:{name:"div",classes:"msg info"},title:"Mensaje - info"},{model:"msg-action",view:{name:"div",classes:"msg action"},title:"Mensaje - action"},{model:"msg-primary",view:{name:"div",classes:"msg primary"},title:"Mensaje - primary"},{model:"msg-secondary",view:{name:"div",classes:"msg secondary"},title:"Mensaje - secondary"}]},this.optionsAdmin={toolbar:{items:this.itemsAdmin},language:"es",image:{toolbar:["imageTextAlternative","imageStyle:full","imageStyle:side","linkImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableCellProperties","tableProperties"]},heading:this.heading,htmlEmbed:{showPreviews:!0},simpleUpload:{uploadUrl:"/v1/admin/super/multimedia"}},this.optionsUser={toolbar:{items:this.itemsUser},language:"es",image:{toolbar:["imageTextAlternative","imageStyle:full","imageStyle:side","linkImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableCellProperties","tableProperties"]},heading:this.heading},this.cke(),this.mapEdit(),this.mapEditPoint(),this.mapMarkers(),this.addFeature()}e.prototype.cke=function(){var i=this,e=$(".cke-admin,.cke-user");e.length&&e.each(function(e,t){var a={},a=$(t).hasClass("cke-admin")?i.optionsAdmin:i.optionsUser;ClassicEditor.create(t,a).then(function(e){e.model.document.on("change:data",function(){$(t).val(e.getData())})}).catch(function(e){console.error(e)})})},e.prototype.mapEdit=function(){var e;$("#map-edit").length&&(e=($("#center").val()||",").split(","),this._mapEdit({latitude:e[1]||4.646876,longitude:e[0]||-74.087547}))},e.prototype._mapEdit=function(e){var t=[e.latitude,e.longitude],a=L.map("map-edit").setView(t,13);L.control.locate({initialZoomLevel:15,locateOptions:{enableHighAccuracy:!0,maxZoom:15},strings:{title:"Localizar mi posición"}}).addTo(a),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a);var i=[];try{i=JSON.parse($("#points").val())}catch(e){i=[]}i.length&&(e={type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[i.map(function(e){return[e.lng,e.lat]})]}}]},(t=L.geoJson(null,{pmIgnore:!1})).addTo(a),t.addData(e),t.on("pm:edit",function(e){e=e.layer._latlngs[0];$("#points").val(JSON.stringify(e))}),t.on("pm:dragend",function(e){e=e.layer._latlngs[0];$("#points").val(JSON.stringify(e))}),t.on("pm:remove",function(){$("#points").val("[]")})),a.pm.addControls({position:"topleft",drawMarker:!1,drawCircleMarker:!1,drawRectangle:!1,drawPolyline:!1,drawCircle:!1,cutPolygon:!1}),a.on("pm:drawstart",function(){var e=a.pm.getGeomanDrawLayers();$.each(e,function(e,t){t.remove()})}),a.on("pm:create",function(e){var t=e.layer._latlngs[0];$("#points").val(JSON.stringify(t)),e.layer.on("pm:ediit",function(e){e=e.layer._latlngs[0];$("#points").val(JSON.stringify(e))}),e.layer.on("pm:dragend",function(e){e=e.layer._latlngs[0];$("#points").val(JSON.stringify(e))}),e.layer.on("pm:remove",function(){$("#points").val("[]")})})},e.prototype.mapEditPoint=function(){var e;$("#map-edit-point").length&&($("#point").val(),e=",".split(","),this._mapEditPoint({latitude:e[1]||4.646876,longitude:e[0]||-74.087547}))},e.prototype._mapEditPoint=function(e){var t=L.map("map-edit-point").setView([e.latitude,e.longitude],13);L.control.locate({initialZoomLevel:15,locateOptions:{enableHighAccuracy:!0,maxZoom:15},strings:{title:"Localizar mi posición"}}).addTo(t),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(t);var a=L.marker([e.latitude,e.longitude],{draggable:!0}).addTo(t);a.on("dragend",function(){$("#point").val(a.getLatLng().lng+","+a.getLatLng().lat)}),t.on("locationfound",function(e){$("#point").val(a.getLatLng().lng+","+a.getLatLng().lat),a.setLatLng(e.latlng).bindPopup("Mueva el marcador si es necesario").openPopup()})},e.prototype.mapMarkers=function(){if($("#map-markers").length)try{var e=JSON.parse($("#markers").val());this._mapMarkers(e)}catch(e){this._mapMarkers([])}},e.prototype._mapMarkers=function(e){var t=($("#center").val()||",").split(","),a=L.map("map-markers").setView([t[1]||4.646876,t[0]||-74.087547],11);L.control.locate({initialZoomLevel:15,locateOptions:{enableHighAccuracy:!0,maxZoom:15},strings:{title:"Localizar mi posición"}}).addTo(a),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),e.forEach(function(e){L.marker([e[1],e[0]]).addTo(a)})},e.prototype.addFeature=function(){var e=$(".list-features");e.length&&e.each(function(e,t){function a(){var a="";n.forEach(function(e,t){a+='<div class="form-group flex">',a+='<div class="form-control">',a+='<input type="text" id="i_'+t+'" class="input" placeholder=" " name="features['+t+'][name]" value="'+e.name+'" data-index="'+t+'" data-name="name">',a+='<label for="i_'+t+'">Nombre</label>',a+="</div>",a+='<div class="form-control pl-1">',a+='<input type="text" id="v_'+t+'" class="input" placeholder=" " name="features['+t+'][value]" value="'+e.value+'" data-index="'+t+'" data-name="value">',a+='<label for="v_'+t+'">Valor</label>',a+="</div>",a+="</div>"}),i.html(a),i.find("input").each(function(e,t){var a=$(t);a.on("input",function(){n[a.data("index")][a.data("name")]=a.val()})})}var i=$(t),n=i.data("features");a(),$(i.data("btn")).on("click",function(){n.push({name:"",value:"",slug:""}),a()})})},t("Edit",e)}}}),System.register("libs/vars",["../util/products.d"],function(e,t){"use strict";t&&t.id;return{setters:[function(e){}],execute:function(){function a(){}a.badge=function(e){return'<span class="badge '+{created:"primary",paid:"alert",cancelled:"error",cancelledAdmin:"error",picking:"alert",ready:"info",onway:"info",arrived:"info",missing:"error",completed:"action"}[e]+' inline">'+{created:"Creado",paid:"Pagado",cancelled:"Cancelado",cancelledAdmin:"Cancelado",picking:"Buscando Productos",ready:"Listo Para Envíar",onway:"En Camino",arrived:"Llegó",missing:"No Respondieron",completed:"Completado"}[e]+"</span>"},a.payment=function(e){return'<button class="primary small id_'+e+' w-100">Pagar</button>'},a.statusToDate=function(e,t){e=e.filter(function(e){return e.status===t});return e.length?a.format(e[0].date):""},a.format=function(e){if(!e)return"";var t=new Date;return t.setTime(Date.parse(e)),t.getDate()+" de "+["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][t.getMonth()]+" de "+t.getFullYear()},a.formatMoney=function(e,t,a,i,n){void 0===t&&(t=0),void 0===a&&(a="$"),void 0===i&&(i=","),void 0===n&&(n=".");var o="\\d(?=(\\d{3})+"+(0<t?"\\D":"$")+")";return a+e.toFixed(Math.max(0,~~t)).replace(".",n).replace(new RegExp(o,"g"),"$&"+i)},a.getParameterByName=function(e,t){void 0===t&&(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null},a.capitalize=function(e){return e[0].toUpperCase()+e.slice(1)},a.b=$("body"),a.urlSite=a.b.data("urlSite"),a.urlApi=a.b.data("urlApi"),a.urlS3=a.b.data("urlS3"),a.urlS3Images=a.b.data("urlS3Images"),a.imgNoAvailable="/images/imagen_no_disponible.svg",a.store=a.b.data("store"),a.place=a.b.data("defaultPlace"),a.webp=0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp"),e("Vars",a)}}}),System.register("libs/get_api",["../util/sclib.d","libs/vars"],function(t,e){"use strict";var a;e&&e.id;return{setters:[function(e){},function(e){a=e}],execute:function(){function e(e){this.h={},e&&(this.h={Authorization:"bearer "+e})}e.prototype.gs=function(e,t){return void 0===t&&(t=a.Vars.store),this.g(t+"/"+e)},e.prototype.g=function(e){return sclib.ajax({url:a.Vars.urlApi+e,type:"GET",headers:this.h})},e.prototype.ps=function(e,t){return void 0===t&&(t={}),this.p(a.Vars.store+"/"+e,t)},e.prototype.p=function(e,t){return void 0===t&&(t={}),sclib.ajax({url:a.Vars.urlApi+e,type:"POST",headers:this.h,data:JSON.stringify(t)})},t("GetApi",e)}}}),System.register("libs/session",[],function(t,e){"use strict";e&&e.id;return{setters:[],execute:function(){function e(){var e;this.token=localStorage.getItem("token");try{this.user=JSON.parse(localStorage.getItem("user")),this.token?(null!==(e=null===(e=this.user)||void 0===e?void 0:e.personalInfo)&&void 0!==e&&e.firstname&&$(".userFirstname").html(this.user.personalInfo.firstname.split(" ")[0]),$(".nologin").hide(),$(".login").show()):($(".login").hide(),$(".nologin").show())}catch(e){$(".login").hide(),$(".nologin").show()}}e.checkWebpFeature=function(t,a){var i=new Image;i.onload=function(){var e=0<i.width&&0<i.height;a(t,e)},i.onerror=function(){a(t,!1)},i.src="data:image/webp;base64,"+{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"}[t]},t("Session",e)}}}),System.register("libs/util",["libs/session","libs/get_api"],function(t,e){"use strict";var a,i;e&&e.id;return{setters:[function(e){a=e},function(e){i=e}],execute:function(){function e(){this.session=new a.Session,this.session=new a.Session,this.getApi=new i.GetApi(this.session.token),this.count(),this.lazy(),this.showDetailOrder(),this.changeTowns(),this.btnBbcodeImg(),this.openModalAction(),this.openModalMsg()}e.prototype.count=function(){var i=this;$("[data-count]").each(function(e,t){var a=$(t);i._color(a),a.on("input",function(){i._color(a)})})},e.prototype._color=function(e){var t=e.val().length,a=$(e.data("target"));t>parseInt(e.data("count"),10)?a.parent().addClass("t-error"):a.parent().removeClass("t-error"),a.html(""+t)},e.prototype.lazy=function(){var t=0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp");$(".lazy").Lazy({beforeLoad:function(e){t&&(e.attr("data-src",e.data("src").replace(".jpg",".webp")),e.data("retina")&&e.attr("data-retina",e.data("retina").replace(".jpg",".webp")))}})},e.prototype.showDetailOrder=function(){$(".btn-next-status").on("click",function(){sclib.modalShow("#modalNextStatus")}),$(".btn-cancel").on("click",function(){sclib.modalShow("#cancelOrder")})},e.prototype.changeTowns=function(){var a=this;$(".department").on("change",function(e){var t=$(e.currentTarget);a.getApi.g("towns/"+t.val()).done(function(e){var a=$(t.data("target"));a.empty(),a.append($("<option></option>").attr("value","").text("--")),$.each(e,function(e,t){a.append($("<option></option>").attr("value",t.name).text(t.name))})})})},e.prototype.btnBbcodeImg=function(){$(".btn-bbcode-img").on("click",function(e){e=$(e.currentTarget);$(e.data("target")).html("<div>"+e.data("bbcode")+"</div><div>"+e.data("linkhtml")+"<div>")})},e.prototype.openModalAction=function(){$(".open-modal-action").on("click",function(e){var t=$(e.currentTarget),a=$("#modalAction"),e=$("#modalActionForm");e.attr("action",t.data("url")),e.attr("method",t.data("method")),e.data("page",t.data("page")),a.find(".title").html(t.data("title")),a.find(".btn-action").html(t.data("action")),a.find(".btn-cancel").html(t.data("cancel")),sclib.modalShow("#modalAction")})},e.prototype.openModalMsg=function(){$(".open-modal-msg").on("click",function(e){var t=$(e.currentTarget),e=$("#modalMsg");e.find(".title").html(t.data("title")),e.find(".btn--primary").html(t.data("close")),e.find(".body").html($(t.data("body")).html()),sclib.modalShow("#modalMsg")})},t("Util",e)}}}),System.register("admin",["./libs/define","libs/edit","libs/util"],function(e,t){"use strict";var a,i;t&&t.id;return{setters:[function(e){},function(e){a=e},function(e){i=e}],execute:function(){new a.Edit,new i.Util}}}),System.active();
